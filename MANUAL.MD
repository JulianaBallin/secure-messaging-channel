# ğŸš€ Guia de ExecuÃ§Ã£o â€” Canal de ComunicaÃ§Ã£o Seguro (CipherTalk)

Este guia explica **passo a passo** como rodar o sistema completo do projeto CipherTalk, incluindo o servidor, o banco de dados e os clientes CLI.  
O objetivo Ã© permitir **comunicaÃ§Ã£o segura ponta a ponta (E2EE)** entre mÃºltiplos usuÃ¡rios em terminais diferentes.

---

## âš™ï¸ 1ï¸âƒ£ PrÃ©-requisitos

Antes de tudo, garanta que vocÃª possui instalado:
- ğŸ **Python 3.12+**
- ğŸ§° **Virtualenv** (para isolar dependÃªncias)
- ğŸ“¦ **Make** (opcional, mas facilita comandos repetitivos)
- ğŸ” **OpenSSL** (para gerar certificados TLS)

---

## ğŸ“¦ 2ï¸âƒ£ Instalar dependÃªncias

```bash
# Crie e ative o ambiente virtual
python -m venv venv
source venv/bin/activate  # no Linux
# ou
venv\Scripts\activate     # no Windows

# Instale as dependÃªncias
pip install -r requirements.txt
```

Verifique se o mÃ³dulo `pycryptodomex` estÃ¡ corretamente instalado:

```bash
pip show pycryptodomex
```

Se o IDEA nativo nÃ£o estiver disponÃ­vel, o sistema usarÃ¡ automaticamente o fallback em Python puro.

---

## ğŸ—„ï¸ 3ï¸âƒ£ Inicializar o banco de dados

O servidor usa **SQLite** como banco de dados local.
Para garantir que as tabelas estÃ£o criadas corretamente, execute:

```bash
python init_db.py
```

ou simplesmente inicie o servidor (ele cria o banco automaticamente).

O arquivo do banco serÃ¡ salvo em:

```
backend/database/cipher_talk.db
```

---

## ğŸ§± 4ï¸âƒ£ Iniciar o servidor (backend)

O servidor Ã© responsÃ¡vel por:

* Gerenciar conexÃµes seguras (TLS/SSL)
* Autenticar usuÃ¡rios
* Armazenar mensagens criptografadas
* Roteamento entre clientes online/offline

### ğŸ”¹ Executar o servidor:

```bash
python backend/server/server.py
```

Durante a primeira execuÃ§Ã£o:

* Certificados TLS (`cert.pem` e `key.pem`) serÃ£o gerados automaticamente.
* O banco serÃ¡ verificado/criado.
* O servidor iniciarÃ¡ na porta padrÃ£o `8888`.

SaÃ­da esperada:

```
ğŸ—„ï¸ Banco de dados verificado e atualizado com sucesso.
[SERVER] Servidor seguro rodando em ('127.0.0.1', 8888) (TLS habilitado)
```

> ğŸ’¡ **Mantenha esse terminal aberto**, pois ele Ã© o "servidor central" â€” os clientes vÃ£o se conectar a ele.

---

## ğŸ’» 5ï¸âƒ£ Executar o cliente (CLI)

Em outro terminal (ou outro computador na mesma rede), rode:

```bash
python run_cli.py
```

Este script Ã© a interface principal do usuÃ¡rio (cliente CLI).
Ele permite **cadastro, login, envio e leitura de mensagens**.

---

## ğŸ§­ 6ï¸âƒ£ Uso do cliente CLI

ApÃ³s rodar o cliente, o menu principal serÃ¡ exibido:

```
=== ğŸ” CipherTalk CLI ===
1ï¸âƒ£  - Cadastrar novo usuÃ¡rio
2ï¸âƒ£  - Fazer login
0ï¸âƒ£  - Sair
```

### ğŸ“ Cadastrar novo usuÃ¡rio

1ï¸âƒ£ Escolha a opÃ§Ã£o `1`.
2ï¸âƒ£ Informe nome de usuÃ¡rio e senha.
3ï¸âƒ£ O sistema:

* Gera automaticamente um par RSA.
* Salva a chave privada localmente em `keys/<usuario>_private.pem`.
* Envia a chave pÃºblica ao servidor.

---

### ğŸ”‘ Fazer login

2ï¸âƒ£ Escolha a opÃ§Ã£o `2`.
Informe seu usuÃ¡rio e senha cadastrados.
ApÃ³s o login bem-sucedido, vocÃª verÃ¡ o menu interno:

```
=== ğŸ’¬ CipherTalk - UsuÃ¡rio: Juliana ===
1ï¸âƒ£  - Listar usuÃ¡rios
2ï¸âƒ£  - Enviar mensagem segura (E2EE)
3ï¸âƒ£  - Ler mensagens recebidas
0ï¸âƒ£  - Logout
```

---

### ğŸ‘¥ Listar usuÃ¡rios

1ï¸âƒ£ Mostra todos os usuÃ¡rios cadastrados no servidor, indicando:

* ğŸŸ¢ Online
* âš« Offline
  e se possuem chave pÃºblica vÃ¡lida.

---

### ğŸ’¬ Enviar mensagem segura

2ï¸âƒ£ Digite o nome do destinatÃ¡rio e a mensagem.
O sistema:

* Gera uma chave IDEA aleatÃ³ria (128 bits);
* Criptografa a mensagem com IDEA (modo CBC);
* Criptografa a chave IDEA com a chave pÃºblica RSA do destinatÃ¡rio;
* Envia ao servidor via canal TLS.

> Se o destinatÃ¡rio estiver offline, a mensagem serÃ¡ armazenada criptografada no banco de dados atÃ© ele se conectar.

---

### ğŸ“¥ Ler mensagens recebidas

3ï¸âƒ£ Mostra todas as mensagens recebidas:

* Descriptografa automaticamente com a chave privada RSA local;
* Exibe o conteÃºdo decifrado no terminal.

Mensagens pendentes (armazenadas enquanto o usuÃ¡rio estava offline) tambÃ©m serÃ£o recuperadas ao fazer login.

---

## ğŸ“Š 7ï¸âƒ£ Monitorar logs

Todos os eventos sÃ£o salvos na pasta `logs/`:

| Arquivo        | ConteÃºdo                                                |
| -------------- | ------------------------------------------------------- |
| `server.log`   | ConexÃµes, autenticaÃ§Ãµes, mensagens e erros do servidor. |
| `messages.log` | Logs do cliente (envios, recebimentos, falhas).         |
| `crypto.log`   | OperaÃ§Ãµes de criptografia (IDEA e RSA).                 |
| `database.log` | AÃ§Ãµes do banco (inserÃ§Ãµes, exclusÃµes, falhas).          |

Visualize os logs com:

```bash
tail -f logs/server.log
```

---

## ğŸ§ª 8ï¸âƒ£ Testar criptografia manualmente

Para testar o mÃ³dulo IDEA isoladamente:

```bash
python - <<'EOF'
from backend.crypto.idea_manager import verify_encryption_cycle
verify_encryption_cycle()
EOF
```

SaÃ­da esperada:

```
âœ… Teste IDEA bem-sucedido: criptografia e descriptografia Ã­ntegras.
```

---

## ğŸ§© 9ï¸âƒ£ Estrutura esperada (resumo)

```
secure-messaging-channel/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ crypto/
â”‚   â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ messages/
â”‚   â”œâ”€â”€ server/
â”‚   â””â”€â”€ utils/
â”œâ”€â”€ client/
â”‚   â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ messages/
â”‚   â”œâ”€â”€ menus/
â”‚   â””â”€â”€ run_cli.py
â”œâ”€â”€ logs/
â”‚   â”œâ”€â”€ server.log
â”‚   â”œâ”€â”€ messages.log
â”‚   â”œâ”€â”€ crypto.log
â”‚   â””â”€â”€ database.log
â”œâ”€â”€ keys/
â”‚   â””â”€â”€ <usuario>_private.pem
â””â”€â”€ backend/database/cipher_talk.db
```

---

## âœ… 1ï¸âƒ£0ï¸âƒ£ Dicas finais

* Sempre mantenha o **servidor ativo** antes de abrir os clientes.
* VocÃª pode abrir **vÃ¡rios terminais** para simular diferentes usuÃ¡rios.
* Caso a porta 8888 esteja ocupada, altere a variÃ¡vel no `.env`:

  ```
  SERVER_PORT=9999
  ```
* Em caso de erros, verifique o arquivo `logs/server.log`.

---
