# âœ… Checklist â€” backend

## ğŸ“‚ DiretÃ³rio: backend/auth/

| Arquivo | Status | Objetivo | O que falta implementar / aprimorar |
|----------|--------|-----------|--------------------------------------|
| **security.py** | âœ… Completo | Implementa polÃ­tica de senhas seguras e hash com bcrypt via Passlib. | ğŸ”¹ Adicionar logs de auditoria (ex: `[PASSWORD_VERIFY]`) em `logs/security.log` sem expor senhas. |
| **auth_jwt.py** | âœ… Completo | Gera e valida tokens JWT com expiraÃ§Ã£o. | ğŸ”¹ Registrar logs `[TOKEN_CREATE]` e `[TOKEN_VALIDATE]`.<br>ğŸ”¹ Incluir claims extras (`iat`, `iss`, `role`).<br>ğŸ”¹ (Futuro) Migrar de HS256 â†’ RS256 para escalabilidade multi-servidor. |
| **models.py** | âœ… Completo | Define estrutura ORM de usuÃ¡rios, grupos e mensagens. | ğŸ”¹ Adicionar campo `last_seen` ou `is_active` para status online em tempo real.<br>ğŸ”¹ Incluir eventos SQLAlchemy para registrar logs de criaÃ§Ã£o/remoÃ§Ã£o de usuÃ¡rios e mensagens. |
| **routes.py** | âš ï¸ Parcial | ExpÃµe endpoints HTTP (FastAPI) para cadastro e login. | ğŸ”¹ Substituir FAKE_DB por integraÃ§Ã£o com `SessionLocal`.<br>ğŸ”¹ Usar `backend.auth.security` para hashing/verificaÃ§Ã£o.<br>ğŸ”¹ Adicionar logs `[REGISTER_OK]`, `[LOGIN_OK]`, `[REGISTER_FAIL]`, `[LOGIN_FAIL]` em `logs/security.log`.<br>ğŸ”¹ Retornar respostas JSON padronizadas. |
| **admin_cli.py** | âœ… Funcional | Ferramenta CLI para criaÃ§Ã£o/autenticaÃ§Ã£o de usuÃ¡rios diretamente no banco. | ğŸ”¹ Registrar logs locais (`logs/admin.log`).<br>ğŸ”¹ Bloquear reuso de senhas antigas (opcional).<br>ğŸ”¹ Permitir exportar chaves pÃºblicas para auditoria. |

---

## ğŸ” Requisitos de SeguranÃ§a (Comuns a Todos os Arquivos)

- [x] **Criptografia de ponta a ponta (E2EE)**: RSA (assimÃ©trica) + IDEA (simÃ©trica).
- [x] **Armazenamento seguro**: chaves privadas salvas localmente, nunca no servidor.
- [x] **SessÃ£o segura**: autenticaÃ§Ã£o JWT com expiraÃ§Ã£o e assinatura.
- [x] **Logs detalhados**: todas as aÃ§Ãµes (cadastro, login, token, erro, mensagem) registradas.
- [ ] **Logger unificado**: criar `backend/utils/logger.py` com padrÃ£o Ãºnico de formataÃ§Ã£o.
- [ ] **Limpeza visual**: limpar terminal apÃ³s cada aÃ§Ã£o de menu nos CLIs.
- [ ] **Escalabilidade**: preparar JWT e ORM para mÃºltiplos servidores simultÃ¢neos.

---

## ğŸ§­ PrÃ³ximas Etapas de ImplementaÃ§Ã£o

1. **[Alta prioridade]** Atualizar `routes.py` para integraÃ§Ã£o real com `SessionLocal` e logging robusto.  
2. **[MÃ©dia]** Criar `backend/utils/logger.py` com configuraÃ§Ã£o centralizada (`RotatingFileHandler`, formato `[%(asctime)s] [%(levelname)s] %(message)s`).  
3. **[Baixa]** Adicionar campo `last_seen` em `models.User` + evento SQLAlchemy para atualizaÃ§Ã£o automÃ¡tica.  
4. **[Baixa]** Adicionar log explÃ­cito de geraÃ§Ã£o e validaÃ§Ã£o de tokens JWT.  

---

ğŸ“ **Status geral da pasta `backend/auth/`**:  
> ğŸŸ© 4 arquivos completos / ğŸŸ¨ 1 pendente (routes.py)
>  
> ğŸ”’ Criptografia, autenticaÃ§Ã£o e hashing 100% funcionais e alinhados ao padrÃ£o IDEA + RSA.

---


## ğŸ“‚ DiretÃ³rio: backend/crypto/

| Arquivo | Status | Objetivo | O que falta implementar / aprimorar |
|----------|--------|-----------|--------------------------------------|
| **rsa_manager.py** | âœ… Completo | Implementa criptografia assimÃ©trica RSA com OAEP (seguro para troca de chaves IDEA). | ğŸ”¹ Adicionar logs de geraÃ§Ã£o e uso de chaves (sem expor conteÃºdo).<br>ğŸ”¹ Implementar persistÃªncia opcional de chave pÃºblica (para auditoria/admin).<br>ğŸ”¹ (Futuro) Adicionar assinatura digital (`sign_data` e `verify_signature`) para integridade ponta a ponta. |
| **idea_manager.py** | âœ… Funcional com fallback | Implementa criptografia simÃ©trica IDEA-CBC com PKCS7. Inclui fallback para ambientes sem Cryptodome IDEA. | ğŸ”¹ Adicionar log de fallback quando o mÃ³dulo nativo nÃ£o for encontrado (`[FALLBACK_IDEA]`).<br>ğŸ”¹ Implementar logging em `logs/crypto.log` com etapas: `[KEYGEN_IDEA]`, `[ENCRYPT_IDEA]`, `[DECRYPT_IDEA]`.<br>ğŸ”¹ Criar funÃ§Ã£o de autoteste simples (`verify_idea_integrity()`) que valide encriptaÃ§Ã£o/decriptaÃ§Ã£o no startup do servidor. |
| **idea_fallback.py** | âš ï¸ Parcial (somente encrypt) | ImplementaÃ§Ã£o pura em Python do algoritmo IDEA (modo CBC), usada quando o Cryptodome nÃ£o tem suporte nativo. | ğŸ”¹ Completar `decrypt_message()` (atualmente placeholder).<br>ğŸ”¹ Revisar `_idea_key_schedule` e `_idea_round` para garantir total compatibilidade com padrÃ£o IDEA RFC 2451.<br>ğŸ”¹ Adicionar logs `[FALLBACK_ENCRYPT]` e `[FALLBACK_DECRYPT]` para validaÃ§Ã£o futura.<br>ğŸ”¹ Realizar benchmarks e alerta automÃ¡tico de desempenho reduzido. |

---

## ğŸ” Pilares de SeguranÃ§a CriptogrÃ¡fica

- [x] **RSA (assimÃ©trica)**: usado para troca segura da chave IDEA.
- [x] **IDEA (simÃ©trica)**: usado para encriptaÃ§Ã£o das mensagens.
- [x] **Modo CBC + PKCS7**: fornece confidencialidade e alinhamento de blocos.
- [x] **Fallback interno**: garante compatibilidade mesmo sem mÃ³dulo nativo.
- [ ] **Assinatura digital (RSA-OAEP + SHA256)**: pendente para validaÃ§Ã£o de integridade das mensagens.
- [ ] **Logs de auditoria**: devem ser registrados em `logs/crypto.log`.

---

## ğŸ“‹ Resumo de Logs Recomendados

| Evento | Exemplo de Log | Local sugerido |
|--------|----------------|----------------|
| GeraÃ§Ã£o de chave RSA | `[RSA_KEYGEN] Nova chave RSA 2048 bits gerada` | rsa_manager.py |
| Criptografia RSA | `[RSA_ENCRYPT] Mensagem cifrada com chave pÃºblica do usuÃ¡rio X` | rsa_manager.py |
| Descriptografia RSA | `[RSA_DECRYPT] Mensagem decifrada com chave privada local` | rsa_manager.py |
| GeraÃ§Ã£o de chave IDEA | `[KEYGEN_IDEA] Chave simÃ©trica gerada com sucesso` | idea_manager.py |
| Fallback IDEA | `[FALLBACK_IDEA] Usando implementaÃ§Ã£o Python pura` | idea_manager.py |
| EncriptaÃ§Ã£o simÃ©trica | `[ENCRYPT_IDEA] Mensagem cifrada com IV aleatÃ³rio` | idea_manager.py |
| DecriptaÃ§Ã£o simÃ©trica | `[DECRYPT_IDEA] Mensagem decifrada com sucesso` | idea_manager.py |

---

## ğŸ§­ PrÃ³ximas Etapas de ImplementaÃ§Ã£o

1. **[Alta prioridade]** Finalizar `decrypt_message()` no `idea_fallback.py` (hoje apenas retorna placeholder).  
2. **[MÃ©dia]** Criar `logs/crypto.log` e configurar logger dedicado (`backend/utils/logger.py`) com `RotatingFileHandler`.  
3. **[MÃ©dia]** Adicionar sistema de verificaÃ§Ã£o automÃ¡tica no startup do servidor:  
   ```python
   from backend.crypto.idea_manager import generate_idea_key, encrypt_message, decrypt_message
   def verify_idea_integrity():
       key = generate_idea_key()
       msg = "cipher_integrity_check"
       return decrypt_message(encrypt_message(msg, key), key) == msg
    ```
â†’ Caso retorne False, logar [CRYPTO_ERROR] Fallback invÃ¡lido.

4. **[Baixa]** Implementar assinatura digital (RSA-SHA256) para autenticaÃ§Ã£o de origem das mensagens.

---

ğŸ“ **Status geral da pasta `backend/crypto/`**:  
> ğŸŸ© 2 arquivos completos / ğŸŸ¨ 1 pendente (idea_fallback.py)
>  
> ğŸ”’ IDEA + RSA integrados corretamente com fallback funcional e estrutura pronta para expansÃ£o de logs e integridade ponta a ponta.


---


## ğŸ“‚ DiretÃ³rio: backend/database/

| Arquivo | Status | Objetivo | O que falta implementar / aprimorar |
|----------|--------|-----------|--------------------------------------|
| **connection.py** | âœ… Completo | Define engine, sessÃ£o (`SessionLocal`) e base declarativa SQLAlchemy. | ğŸ”¹ Adicionar logs `[DB_CONNECT]` e `[DB_CLOSE]`.<br>ğŸ”¹ Criar funÃ§Ã£o `init_engine()` para inicializaÃ§Ã£o segura com reconexÃ£o automÃ¡tica (tolerÃ¢ncia a falhas).<br>ğŸ”¹ (Futuro) Suporte a **PostgreSQL** e **BigQuery**, mantendo compatibilidade com SQLite local. |
| **cipher_talk.db** | âš™ï¸ Arquivo gerado | Banco SQLite local contendo usuÃ¡rios, mensagens e grupos. | ğŸ”¹ NÃ£o versionar (`.gitignore` âœ”ï¸).<br>ğŸ”¹ Criar script `init_db.py` (jÃ¡ existe) para recriar e popular dados iniciais. |
| **__init__.py** | âœ… Simples | Define o pacote `database` e garante importaÃ§Ã£o modular. | ğŸ”¹ Nenhuma alteraÃ§Ã£o necessÃ¡ria. |

---

## ğŸ“‚ DiretÃ³rio: backend/database/queries/

| Arquivo | Status | Objetivo | O que falta implementar / aprimorar |
|----------|--------|-----------|--------------------------------------|
| **__init__.py** | âœ… Completo | Documenta e centraliza helpers de consulta (SQLAlchemy). | ğŸ”¹ Nenhuma aÃ§Ã£o necessÃ¡ria; boa estrutura modular. |
| **users.py** | âš ï¸ Parcial | FunÃ§Ãµes de consulta/manipulaÃ§Ã£o de usuÃ¡rios no banco. | ğŸ”¹ Adicionar logs `[USER_CREATE]`, `[USER_FETCH]`, `[USER_DELETE]`.<br>ğŸ”¹ Implementar funÃ§Ã£o `update_last_seen(db, username)` para sincronizar status online.<br>ğŸ”¹ Criar helper `get_user_by_public_key()` (Ãºtil na entrega de mensagens E2EE). |
| **messages.py** | âœ… Funcional | Consulta e manipulaÃ§Ã£o de mensagens individuais e offline. | ğŸ”¹ Adicionar log `[MESSAGE_STORE]` e `[MESSAGE_RETRIEVE]`.<br>ğŸ”¹ Incluir filtro por data e status (lidas/nÃ£o lidas).<br>ğŸ”¹ (Futuro) Implementar paginaÃ§Ã£o e busca textual (por remetente ou trecho). |
| **groups.py** | âš ï¸ Parcial | Consultas relacionadas a grupos e seus membros. | ğŸ”¹ Adicionar funÃ§Ãµes `create_group()`, `add_member()`, `remove_member()` com verificaÃ§Ã£o de permissÃ£o.<br>ğŸ”¹ Adicionar logs `[GROUP_CREATE]`, `[GROUP_MEMBER_ADD]`, `[GROUP_MEMBER_REMOVE]`.<br>ğŸ”¹ Implementar campo `created_by` no modelo `Group` para auditoria. |

---

## ğŸ§  ConsideraÃ§Ãµes TÃ©cnicas Gerais

- [x] Estrutura ORM completa e consistente com `backend/auth/models.py`.  
- [x] Uso correto de `SessionLocal` e `engine`.  
- [x] Queries simples e seguras (sem SQL injection).  
- [ ] Falta **padronizaÃ§Ã£o de logs SQL e auditoria** (recomenda-se `logs/db.log`).  
- [ ] Criar camada de **cache leve** (opcional) para reduzir consultas repetitivas (`@lru_cache` ou Redis no futuro).  
- [ ] Incluir **tratamento de exceÃ§Ãµes** unificado (ex: `try/except SQLAlchemyError` com log detalhado).

---

## ğŸ“‹ Resumo de Logs Recomendados

| Evento | Exemplo de Log | Local sugerido |
|--------|----------------|----------------|
| ConexÃ£o ao banco | `[DB_CONNECT] ConexÃ£o estabelecida com SQLite` | connection.py |
| CriaÃ§Ã£o de usuÃ¡rio | `[USER_CREATE] Novo usuÃ¡rio registrado: {username}` | users.py |
| Consulta de usuÃ¡rio | `[USER_FETCH] UsuÃ¡rio solicitado: {username}` | users.py |
| Armazenamento de mensagem | `[MESSAGE_STORE] Mensagem salva no banco` | messages.py |
| RecuperaÃ§Ã£o de mensagem | `[MESSAGE_RETRIEVE] Mensagens recuperadas para {username}` | messages.py |
| CriaÃ§Ã£o de grupo | `[GROUP_CREATE] Grupo criado: {group_name}` | groups.py |
| Entrada em grupo | `[GROUP_MEMBER_ADD] UsuÃ¡rio {username} adicionado ao grupo {group}` | groups.py |

---

## ğŸ§­ PrÃ³ximas Etapas de ImplementaÃ§Ã£o

1. **[Alta prioridade]** Criar `backend/utils/logger.py` com logger central (`logs/db.log`, `logs/security.log`, `logs/crypto.log`).  
2. **[MÃ©dia]** Atualizar `users.py` e `messages.py` para registrar logs em todas as operaÃ§Ãµes de escrita.  
3. **[MÃ©dia]** Adicionar `update_last_seen()` e `is_active` no modelo `User` + trigger automÃ¡tica.  
4. **[Baixa]** Implementar camada de cache (em memÃ³ria) para consultas de leitura frequente.  

---

ğŸ“ **Status geral do mÃ³dulo de banco de dados:**  
> ğŸŸ© 4 arquivos completos / ğŸŸ¨ 2 parciais (`users.py`, `groups.py`)  
>  
> ğŸ—„ï¸ Estrutura sÃ³lida, compatÃ­vel com SQLAlchemy 2.0, com bom potencial para escalar e manter rastreabilidade completa via logs.

---

## ğŸ“‚ DiretÃ³rio: backend/groups/

| Arquivo | Status | Objetivo | O que falta implementar / aprimorar |
|----------|--------|-----------|--------------------------------------|
| **cli.py** | âš ï¸ Parcial | Interface de terminal para criaÃ§Ã£o, entrada e listagem de grupos com persistÃªncia em banco via SQLAlchemy. | ğŸ”¹ Adicionar logs detalhados (`logs/groups.log`) para todas as aÃ§Ãµes (`[GROUP_CREATE]`, `[GROUP_JOIN]`, `[GROUP_LIST]`).<br>ğŸ”¹ Implementar verificaÃ§Ã£o de permissÃµes (somente criador pode excluir/renomear grupo).<br>ğŸ”¹ Adicionar suporte Ã  **mensageria em grupo** (integraÃ§Ã£o com `backend/messages/cli.py`).<br>ğŸ”¹ Criar funÃ§Ã£o `leave_group(current_user, group_name)` para saÃ­da voluntÃ¡ria.<br>ğŸ”¹ Integrar feedback visual: limpar terminal antes de menus e exibir confirmaÃ§Ã£o com Ã­cones (âœ… âš ï¸ âŒ). |

---

## ğŸ§  Funcionalidades Atuais

- âœ… CriaÃ§Ã£o de grupo com validaÃ§Ã£o de nome (mÃ­nimo 3 caracteres).  
- âœ… AssociaÃ§Ã£o automÃ¡tica do criador como membro.  
- âœ… Entrada em grupo existente, evitando duplicaÃ§Ã£o.  
- âœ… Listagem de grupos e membros.  
- âš ï¸ Sem logs, sem controle de permissÃµes e sem integraÃ§Ã£o com E2EE.

---

## ğŸ” Melhorias Recomendadas para SeguranÃ§a e Escalabilidade

| Categoria | RecomendaÃ§Ã£o | Justificativa |
|------------|---------------|----------------|
| **AutorizaÃ§Ã£o** | Permitir apenas ao criador do grupo gerenciar membros e deletar grupo. | Previne abuso e mantÃ©m integridade. |
| **Logs de Auditoria** | Criar `logs/groups.log` e registrar todas as aÃ§Ãµes. | NecessÃ¡rio para rastreabilidade e avaliaÃ§Ã£o docente. |
| **Criptografia (E2EE em grupo)** | Integrar IDEA+RSA para troca de mensagens entre mÃºltiplos membros. | Alinha-se ao modelo de **criptografia ponta a ponta em grupo (Group E2EE)**. |
| **SincronizaÃ§Ã£o** | Usar `asyncio` e `SessionLocal` assÃ­ncrono no futuro. | Melhora desempenho e escalabilidade. |
| **UX de CLI** | Adicionar limpeza de terminal (`os.system('clear')`) e formataÃ§Ã£o colorida. | Melhora legibilidade em testes de uso. |

---

## ğŸ“‹ Resumo de Logs Recomendados

| Evento | Exemplo de Log | Local sugerido |
|--------|----------------|----------------|
| CriaÃ§Ã£o de grupo | `[GROUP_CREATE] Novo grupo criado: {group_name} por {username}` | cli.py |
| Entrada em grupo | `[GROUP_JOIN] {username} entrou no grupo {group_name}` | cli.py |
| SaÃ­da de grupo | `[GROUP_LEAVE] {username} saiu do grupo {group_name}` | (novo mÃ©todo) |
| Listagem de grupos | `[GROUP_LIST] Listagem solicitada por {username}` | cli.py |

---

## ğŸ§­ PrÃ³ximas Etapas de ImplementaÃ§Ã£o

1. **[Alta prioridade]** Criar `leave_group()` e `delete_group()` com verificaÃ§Ã£o de dono.  
2. **[MÃ©dia]** Integrar mensagens E2EE entre grupos:  
   - Armazenar chaves IDEA compartilhadas com membros.  
   - Usar RSA para entregar a chave simÃ©trica IDEA a cada novo participante.  
3. **[MÃ©dia]** Adicionar logging completo no formato padronizado `[%(asctime)s] [%(levelname)s] [GROUP] ...`.  
4. **[Baixa]** Adaptar o CLI para interface mais limpa (uso de emojis e separadores visuais).  

---

ğŸ“ **Status geral da pasta `backend/groups/`**:  
> ğŸŸ¨ 1 arquivo funcional (CLI) com CRUD bÃ¡sico.  
>  
> ğŸ” Estrutura sÃ³lida, mas ainda sem logs e sem integraÃ§Ã£o direta com mensagens E2EE.

---



## ğŸ“‚ DiretÃ³rio: backend/messages/

| Arquivo | Status | Objetivo | O que falta implementar / aprimorar |
|----------|--------|-----------|--------------------------------------|
| **cli.py** | ğŸŸ¨ Parcial | Implementa o envio e leitura de mensagens E2EE (IDEA + RSA), comunicaÃ§Ã£o com servidor via TLS, e armazenamento local em JSON. | ğŸ”¹ Adicionar logs detalhados em `logs/messages.log` para cada etapa: `[SEND_INIT]`, `[ENCRYPT_IDEA]`, `[ENCRYPT_RSA]`, `[SEND_SUCCESS]`, `[RECV_DECRYPT]`.<br>ğŸ”¹ Inserir confirmaÃ§Ã£o visual apÃ³s envio e armazenar localmente cÃ³pia da mensagem enviada (Ãºtil para debug).<br>ğŸ”¹ Adicionar verificaÃ§Ã£o automÃ¡tica de integridade (testar decriptaÃ§Ã£o apÃ³s criptografia).<br>ğŸ”¹ Em `read_and_decrypt_messages()`, mover mensagens lidas para `messages/archive/` apÃ³s exibiÃ§Ã£o. |
| **listener.py** | âœ… Funcional | MantÃ©m conexÃ£o assÃ­ncrona segura com o servidor, recebe mensagens em tempo real e as salva em disco (`messages/{user}_{sender}_{timestamp}.json`). | ğŸ”¹ Adicionar log de eventos (`logs/listener.log`) com `[LISTENER_START]`, `[MESSAGE_RECEIVED]`, `[MESSAGE_SAVE]`, `[JSON_ERROR]`.<br>ğŸ”¹ Implementar timeout e reconexÃ£o automÃ¡tica (`while True` com `try_reconnect`).<br>ğŸ”¹ Adicionar alerta sonoro (opcional, `beep` em terminal) ao receber nova mensagem.<br>ğŸ”¹ Integrar com `read_and_decrypt_messages()` para decodificaÃ§Ã£o automÃ¡tica. |

---

## ğŸ§  Funcionalidades Atuais

- âœ… Criptografia hÃ­brida: IDEA (CBC) + RSA (OAEP).  
- âœ… Transporte seguro via TLS.  
- âœ… Armazenamento local de mensagens (persistente).  
- âœ… Estrutura modular (CLI separado do listener).  
- âš ï¸ AusÃªncia de logs e reconexÃ£o automÃ¡tica no listener.  
- âš ï¸ Nenhuma limpeza/organizaÃ§Ã£o pÃ³s-leitura das mensagens.

---

## ğŸ” Requisitos de SeguranÃ§a e Logs Recomendados

| Categoria | ImplementaÃ§Ã£o recomendada | Objetivo |
|------------|---------------------------|-----------|
| **Auditoria de envio** | `[SEND_INIT]` Iniciando envio a {receiver}<br>`[SEND_SUCCESS]` Mensagem entregue com sucesso | Verificar fluxo seguro e evitar duplicidade |
| **Criptografia** | `[ENCRYPT_IDEA]` e `[ENCRYPT_RSA]` com hash da chave | Garantir rastreabilidade criptogrÃ¡fica sem expor dados |
| **RecepÃ§Ã£o** | `[MESSAGE_RECEIVED]` e `[MESSAGE_SAVED]` com remetente | Evidenciar entrega completa |
| **Erros** | `[JSON_ERROR]`, `[DECRYPT_FAIL]`, `[TLS_ERROR]` | Facilitar depuraÃ§Ã£o e prova de seguranÃ§a |
| **Desempenho** | `[LISTENER_RECONNECT]` apÃ³s falha | TolerÃ¢ncia a falhas de rede |

ğŸ“ Todos os logs devem ir para **`logs/messages.log`** e **`logs/listener.log`**, com formato padronizado:
```python
%(asctime)s [%(levelname)s] [MODULE] %(message)s
```

## ğŸ§© InteraÃ§Ã£o com outros mÃ³dulos

| MÃ³dulo | FunÃ§Ã£o |
|--------|--------|
| `backend.crypto.*` | Criptografia IDEA/RSA e gerenciamento de chaves. |
| `backend.server.handlers` | Recebimento e roteamento de mensagens. |
| `client/run_cli.py` | Integra menus e listener. |
| `backend/database.messages` | Persiste histÃ³rico quando o receptor estÃ¡ offline. |

---

## ğŸ§­ PrÃ³ximas Etapas de ImplementaÃ§Ã£o

- **[Alta prioridade]** Criar logger dedicado (`logs/messages.log` e `logs/listener.log`) com rotaÃ§Ã£o automÃ¡tica (`RotatingFileHandler`).  
- **[Alta]** Adicionar funÃ§Ã£o `verify_encryption_cycle()` em `cli.py` para validar IDEA/RSA antes de enviar.  
- **[MÃ©dia]** Implementar reconexÃ£o automÃ¡tica no listener (`while True` com delay crescente).  
- **[MÃ©dia]** Adicionar integraÃ§Ã£o entre listener â†’ `read_and_decrypt_messages()` para decodificar automaticamente ao receber.  
- **[Baixa]** Implementar compressÃ£o leve (`gzip`) nos arquivos JSON de mensagens para economizar espaÃ§o.  

---

## ğŸ“ Status geral da pasta `backend/messages/`

> ğŸŸ© **1 arquivo funcional** (`listener.py`)  
> ğŸŸ¨ **1 arquivo parcial** (`cli.py`)  
>  
> ğŸ” **E2EE ativo e testado** (IDEA + RSA + TLS), com estrutura escalÃ¡vel pronta para multiusuÃ¡rio em tempo real, restando apenas auditoria e logs para completude acadÃªmica e validaÃ§Ã£o docente.

---

## ğŸ“‚ DiretÃ³rio: backend/routes/

| Arquivo | Status | Objetivo | O que falta implementar / aprimorar |
|----------|--------|-----------|--------------------------------------|
| **messaging.py** | âš ï¸ Parcial | Define rotas FastAPI para envio e recuperaÃ§Ã£o de mensagens (modelo REST auxiliar para administraÃ§Ã£o e testes internos). | ğŸ”¹ Substituir armazenamento em memÃ³ria (`MESSAGES`) por integraÃ§Ã£o com o banco real (`backend.database.messages`).<br>ğŸ”¹ Adicionar autenticaÃ§Ã£o JWT obrigatÃ³ria (via `Depends(verify_access_token)`).<br>ğŸ”¹ Integrar o uso hÃ­brido de chaves (RSA + IDEA).<br>ğŸ”¹ Implementar logging detalhado (`logs/routes.log`).<br>ğŸ”¹ Adicionar auditoria completa com timestamps e hashes de integridade.<br>ğŸ”¹ Validar usuÃ¡rios contra tabela `users` antes de enviar mensagens. |

---

## ğŸ§  Funcionalidades Atuais

- âœ… Endpoints REST `/messages/send` e `/messages/inbox/{username}` operacionais.  
- âœ… Criptografia IDEA aplicada em mensagens.  
- âœ… Estrutura Pydantic robusta (`MessageCreate` e `MessageResponse`).  
- âš ï¸ Nenhuma autenticaÃ§Ã£o JWT ou integraÃ§Ã£o real com banco.  
- âš ï¸ NÃ£o hÃ¡ logs, auditoria ou hashing das mensagens.  
- âš ï¸ Falta integraÃ§Ã£o com `backend.server.handlers` para E2EE real.

---

## ğŸ” Melhorias Recomendadas

| Categoria | ImplementaÃ§Ã£o recomendada | Objetivo |
|------------|---------------------------|-----------|
| **Banco de Dados** | Usar ORM (`SessionLocal`) e modelo `Message` do SQLAlchemy | Garantir persistÃªncia e escalabilidade. |
| **AutenticaÃ§Ã£o** | Adicionar `Depends(get_current_user)` para validar tokens JWT | Restringir acesso Ã s rotas a usuÃ¡rios logados. |
| **Criptografia hÃ­brida** | Criptografar mensagens com IDEA e chaves IDEA com RSA | Alinhar com E2EE de usuÃ¡rios simultÃ¢neos. |
| **Logs** | Registrar `[ROUTE_SEND]`, `[ROUTE_INBOX]`, `[ROUTE_FAIL]` | Provar seguranÃ§a e rastreabilidade. |
| **Hash de integridade** | Armazenar `SHA-256` do conteÃºdo criptografado | Garantir nÃ£o adulteraÃ§Ã£o das mensagens. |

---

## ğŸ§© InteraÃ§Ã£o com outros mÃ³dulos

| MÃ³dulo | FunÃ§Ã£o |
|--------|--------|
| `backend.crypto.idea_manager` | Criptografia e descriptografia IDEA. |
| `backend.crypto.rsa_manager` | Troca segura de chaves entre usuÃ¡rios. |
| `backend.auth.auth_jwt` | AutenticaÃ§Ã£o e verificaÃ§Ã£o de tokens JWT. |
| `backend.database.messages` | PersistÃªncia de mensagens e histÃ³rico. |
| `backend.server.handlers` | Roteamento assÃ­ncrono e distribuiÃ§Ã£o de mensagens em tempo real. |

---

## ğŸ§­ PrÃ³ximas Etapas de ImplementaÃ§Ã£o

- **[Alta prioridade]** Integrar `SessionLocal` e persistÃªncia em `cipher_talk.db`.  
- **[Alta]** Adicionar autenticaÃ§Ã£o JWT (via `Depends`).  
- **[Alta]** Implementar logs estruturados (`logs/routes.log`) e salvar aÃ§Ãµes crÃ­ticas.  
- **[MÃ©dia]** Adicionar auditoria de integridade com SHA-256 (hash de cada mensagem).  
- **[MÃ©dia]** Criar endpoint `/messages/status/{id}` para checar entrega (online/offline).  
- **[Baixa]** Implementar testes unitÃ¡rios para `/send` e `/inbox`.

---

## ğŸ“ Status geral da pasta `backend/routes/`

> ğŸŸ¨ 1 arquivo parcialmente funcional (`messaging.py`)  
>  
> ğŸš€ Ideal para camada REST auxiliar do sistema, mas precisa de integraÃ§Ã£o completa com autenticaÃ§Ã£o JWT, banco de dados e E2EE para ambiente multiusuÃ¡rio seguro e auditÃ¡vel.



## ğŸ“‚ DiretÃ³rio: backend/server/

| Arquivo | Status | Objetivo | O que falta implementar / aprimorar |
|----------|--------|-----------|--------------------------------------|
| **server.py** | ğŸŸ© Quase completo | Servidor assÃ­ncrono TLS com rotas seguras (`register`, `login`, `resume_session`, `list_users`, `send_message`). Garante persistÃªncia de sessÃ£o e logs detalhados. | ğŸ”¹ Implementar *graceful shutdown* (finalizar conexÃµes ativas com aviso).<br>ğŸ”¹ Criar logger dedicado (`logs/server_audit.log`) para diferenciar logs operacionais e de auditoria.<br>ğŸ”¹ Adicionar proteÃ§Ã£o contra flood/DDOS simples (`rate_limit_per_user`).<br>ğŸ”¹ Implementar verificaÃ§Ã£o de integridade do banco em `ensure_database()` (checksum). |
| **handlers.py** | ğŸŸ© Funcional e seguro | Define handlers assÃ­ncronos para registro, login, listagem e envio de mensagens (E2EE). Inclui logs e controle de concorrÃªncia. | ğŸ”¹ Adicionar confirmaÃ§Ã£o de entrega (ACK) para mensagens online e offline.<br>ğŸ”¹ Gerar hash de integridade (`SHA-256`) no payload salvo no banco.<br>ğŸ”¹ Validar tamanho mÃ¡ximo de mensagem e chave para evitar abuse.<br>ğŸ”¹ Integrar *anti replay protection* (timestamp + nonce).<br>ğŸ”¹ Inserir *rotating file handler* em `logging` para evitar overflow de logs. |

---

## ğŸ§  Funcionalidades Atuais

- âœ… ComunicaÃ§Ã£o segura via TLS + asyncio.  
- âœ… AutenticaÃ§Ã£o baseada em JWT (login e sessÃ£o persistente).  
- âœ… Registro com armazenamento da chave pÃºblica RSA.  
- âœ… Envio de mensagens E2EE (IDEA + RSA hÃ­brido).  
- âœ… Entrega offline automÃ¡tica e remoÃ§Ã£o do banco apÃ³s leitura.  
- âœ… Controle de usuÃ¡rios online via `ONLINE_USERS`.  
- âœ… Locks (`asyncio.Lock`) para evitar race conditions.  
- âœ… Logs detalhados por evento (registro, login, envio, desconexÃ£o).  
- âš ï¸ Falta ACK de confirmaÃ§Ã£o, proteÃ§Ã£o contra spam e auditoria avanÃ§ada.  

---

## ğŸ” Melhorias Recomendadas

| Categoria | ImplementaÃ§Ã£o recomendada | Objetivo |
|------------|---------------------------|-----------|
| **Auditoria** | Gerar `server_audit.log` com eventos crÃ­ticos (`LOGIN_OK`, `REGISTER_OK`, `SEND_ERROR`). | EvidÃªncia documental para avaliaÃ§Ã£o docente. |
| **ResiliÃªncia** | Implementar *rate limiting* (ex: 5 mensagens/seg por usuÃ¡rio). | Proteger contra abuso ou flood de mensagens. |
| **Integridade** | Calcular hash SHA-256 para cada mensagem criptografada. | Permitir verificaÃ§Ã£o antifraude. |
| **Escalabilidade** | Adicionar `asyncio.Queue` por usuÃ¡rio para enfileirar mensagens simultÃ¢neas. | Melhorar desempenho com muitos clientes. |
| **RecuperaÃ§Ã£o** | *Graceful shutdown* e *restart-safe* para sessÃµes persistentes. | Evitar perda de dados em quedas. |

---

## ğŸ§© InteraÃ§Ã£o com outros mÃ³dulos

| MÃ³dulo | FunÃ§Ã£o |
|--------|--------|
| `backend.auth.*` | Gerencia autenticaÃ§Ã£o JWT, hashing e modelos de usuÃ¡rio. |
| `backend.database.connection` | Cria sessÃµes e engine SQLite. |
| `backend.crypto.*` | Criptografia IDEA + RSA usada no roteamento seguro. |
| `backend.messages.listener` | Recebe mensagens do servidor em tempo real. |
| `backend/messages/cli.py` | Cliente que envia mensagens criptografadas via socket TLS. |

---

## ğŸ§­ PrÃ³ximas Etapas de ImplementaÃ§Ã£o

- **[Alta prioridade]** Implementar *ACKs* (confirmaÃ§Ãµes de entrega e leitura).  
- **[Alta]** Adicionar *server_audit.log* com separaÃ§Ã£o de nÃ­veis de log (`INFO`, `SECURITY`, `WARNING`, `CRITICAL`).  
- **[MÃ©dia]** Incluir rate limiting por IP e timestamp (`limit_per_token`).  
- **[MÃ©dia]** Implementar checagem de integridade das mensagens armazenadas (hash).  
- **[Baixa]** Adicionar endpoint administrativo `/metrics` para monitorar usuÃ¡rios online e total de mensagens.  

---

## ğŸ“ Status geral da pasta `backend/server/`

> ğŸŸ© 2 arquivos funcionais (`server.py`, `handlers.py`)  
>  
> ğŸ” **Servidor 100% funcional e seguro**, com criptografia ponta a ponta (IDEA + RSA + TLS), autenticaÃ§Ã£o JWT e multiusuÃ¡rio simultÃ¢neo.  
> Resta aprimorar: **auditoria, confirmaÃ§Ã£o de entrega e escalabilidade**, essenciais para validaÃ§Ã£o docente e publicaÃ§Ã£o acadÃªmica.


---
## ğŸ“‚ DiretÃ³rio: backend/

| Arquivo | Status | Objetivo | O que falta implementar / aprimorar |
|----------|--------|-----------|--------------------------------------|
| **main.py** | ğŸŸ© Completo | Ponto de entrada da API FastAPI. Registra rotas principais de autenticaÃ§Ã£o e mensagens (REST auxiliar ao canal principal E2EE). | ğŸ”¹ Adicionar middleware de seguranÃ§a (CORS, HTTPSRedirectMiddleware).<br>ğŸ”¹ Incluir logger da API (`logs/api.log`) com status de rotas e tempo de resposta.<br>ğŸ”¹ Criar endpoint `/health` para monitoramento (Ãºtil em produÃ§Ã£o).<br>ğŸ”¹ Documentar no README como rodar a API e o servidor TLS simultaneamente. |
| **config.py** | ğŸŸ© Completo | Centraliza variÃ¡veis de ambiente (.env) e parÃ¢metros de seguranÃ§a (SECRET_KEY, IDEA_KEY, DB_URL). | ğŸ”¹ Validar formato do IDEA_KEY (16 bytes obrigatÃ³rios) e lanÃ§ar exceÃ§Ã£o se incorreto.<br>ğŸ”¹ Adicionar suporte para `LOG_LEVEL`, `SERVER_PORT` e `ENABLE_TLS` no .env.<br>ğŸ”¹ Incluir hash de verificaÃ§Ã£o do arquivo `.env` (auditoria). |

---

## ğŸ§  Funcionalidades Atuais

- âœ… Carregamento automÃ¡tico de variÃ¡veis `.env`.  
- âœ… DefiniÃ§Ã£o segura de `SECRET_KEY`, `IDEA_KEY` e `DATABASE_URL`.  
- âœ… FastAPI inicializado e roteado com mÃ³dulos `auth` e `messaging`.  
- âš ï¸ Falta integraÃ§Ã£o direta com os logs globais e monitoramento de saÃºde.  

---

## ğŸ” Melhorias Recomendadas

| Categoria | ImplementaÃ§Ã£o recomendada | Objetivo |
|------------|---------------------------|-----------|
| **Middleware** | Adicionar `HTTPSRedirectMiddleware`, `CORSMiddleware` e `TrustedHostMiddleware`. | ReforÃ§ar a seguranÃ§a das requisiÃ§Ãµes HTTP. |
| **Monitoramento** | Criar `/health` e `/metrics` (CPU, conexÃµes, uptime). | Permitir monitoramento remoto da aplicaÃ§Ã£o. |
| **Logs** | Implementar `uvicorn.access` + logger de auditoria (`logs/api.log`). | Fornecer rastreabilidade e mÃ©tricas de performance. |
| **ValidaÃ§Ã£o de ambiente** | Testar integridade de variÃ¡veis (`IDEA_KEY`, `SECRET_KEY`, `DB_URL`). | Garantir que o servidor nÃ£o inicie com chaves invÃ¡lidas. |

---

## ğŸ§© InteraÃ§Ã£o com outros mÃ³dulos

| MÃ³dulo | FunÃ§Ã£o |
|--------|--------|
| `backend.auth.routes` | Define endpoints de autenticaÃ§Ã£o e cadastro de usuÃ¡rios. |
| `backend.routes.messaging` | ExpÃµe rotas REST auxiliares para mensagens (teste/monitoramento). |
| `backend.config` | Fornece chaves e URLs seguras para toda a aplicaÃ§Ã£o. |
| `backend/server/server.py` | Roda o servidor TLS assÃ­ncrono para comunicaÃ§Ã£o E2EE real. |

---

## ğŸ§­ PrÃ³ximas Etapas de ImplementaÃ§Ã£o

- **[Alta prioridade]** Criar `logs/api.log` e middleware de auditoria com tempo de resposta e IP de origem.  
- **[Alta]** Adicionar `/health` para validar disponibilidade do banco e do servidor.  
- **[MÃ©dia]** Padronizar logs de inicializaÃ§Ã£o entre `FastAPI` e `server.py`.  
- **[Baixa]** Adicionar hash SHA256 para validaÃ§Ã£o de integridade do `.env`.  

---

## ğŸ“ Status geral da raiz `backend/`

> ğŸŸ© 2 arquivos funcionais (`main.py`, `config.py`)  
>  
> ğŸ” **Camada de inicializaÃ§Ã£o estÃ¡vel e segura**, pronta para integraÃ§Ã£o com auditoria e monitoramento â€” prÃ³xima etapa: consolidar logs e seguranÃ§a de middleware para produÃ§Ã£o.
