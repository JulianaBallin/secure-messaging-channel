# ğŸ§© Mapeamento de ImplementaÃ§Ã£o â€” Canal de ComunicaÃ§Ã£o Seguro (Python + IDEA + RSA)

> âš ï¸ Status geral: todos os mÃ³dulos estÃ£o **parcialmente implementados**, com base funcional jÃ¡ existente.  
> Cada responsÃ¡vel deve revisar, otimizar e completar o cÃ³digo conforme descrito abaixo.

---

## ğŸ‘©â€ğŸ’» Pessoa 1 â€” Criptografia e SeguranÃ§a

### ğŸ§± Caminhos e status

- **Criptografia simÃ©trica IDEA (modo CBC + PKCS7)**  
  ğŸ“‚ `backend/crypto/idea_manager.py`  
  â¤ ImplementaÃ§Ã£o funcional com logs e fallback automÃ¡tico.  
  â¤ NecessÃ¡rio testar novamente apÃ³s reinstalaÃ§Ã£o do IDEA nativo (`pycryptodomex`).  

- **Fallback Python puro (IDEA)**  
  ğŸ“‚ `backend/crypto/idea_fallback.py`  
  â¤ ImplementaÃ§Ã£o completa, mas precisa revisÃ£o da funÃ§Ã£o `decrypt()` (erro de padding).  
  â¤ Testar compatibilidade total com `idea_manager.py`.  

- **Criptografia assimÃ©trica RSA (PKCS1_OAEP)**  
  ğŸ“‚ `backend/crypto/rsa_manager.py`  
  â¤ Implementado com funÃ§Ãµes `generate_rsa_keypair()`, `encrypt_with_rsa()`, `decrypt_with_rsa()`.  
  â¤ Falta revisar integraÃ§Ã£o com `signup_cli.py` e armazenamento de chaves RSA no banco.  

- **Autoteste `verify_encryption_cycle()`**  
  ğŸ“‚ `backend/crypto/idea_manager.py`  
  â¤ Implementado, mas retorna erro de padding no fallback.  
  â¤ Requer correÃ§Ã£o da funÃ§Ã£o `decrypt_message()` no fallback.  

- **Hash seguro de senhas (bcrypt/passlib)**  
  ğŸ“‚ `backend/auth/security.py`  
  â¤ Implementado parcialmente â€” utiliza `passlib` com hash e verificaÃ§Ã£o.  
  â¤ Verificar se o mesmo hash Ã© usado em `handlers.py` e `login_cli.py`.  

- **Logs de seguranÃ§a (`logs/crypto.log`)**  
  ğŸ“‚ `backend/utils/logger_config.py`  
  â¤ Loggers configurados (`crypto_logger` ativo).  
  â¤ Revisar para incluir logs de exceÃ§Ãµes e falhas de integridade.  

- **Compatibilidade com o servidor e fallback automÃ¡tico**  
  ğŸ“‚ `backend/crypto/idea_manager.py` e `backend/server/handlers.py`  
  â¤ Parcialmente implementado â€” IDEA com fallback ativo e RSA funcional.  
  â¤ Verificar integraÃ§Ã£o E2EE no fluxo `send_message()`.

---

## ğŸ§  Pessoa 2 â€” Servidor e ComunicaÃ§Ã£o (Backend)

### ğŸ§± Caminhos e status

- **Servidor assÃ­ncrono com TLS**  
  ğŸ“‚ `backend/server/server.py`  
  â¤ Implementado e funcional, usa asyncio + TLS com certificados automÃ¡ticos.  
  â¤ Falta revisÃ£o de reconexÃ£o (`resume_session`) e tratamento de erros SSL.  

- **Manipuladores (`handlers.py`)**
  ğŸ“‚ `backend/server/handlers.py`  
  â¤ `register`, `login`, `list_users`, `send_message` implementados.  
  â¤ `group_message` ainda nÃ£o implementado.  
  â¤ Adicionar logs detalhados para cada aÃ§Ã£o e auditoria de chaves.  

- **Bloqueio global `USERS_LOCK`**  
  ğŸ“‚ `backend/server/handlers.py`  
  â¤ Implementado corretamente para evitar race conditions.  
  â¤ Testar com mÃºltiplas conexÃµes simultÃ¢neas.  

- **Mensagens offline e reconexÃ£o**
  ğŸ“‚ `backend/server/handlers.py`  
  â¤ Entrega offline implementada, mas testar se mensagens persistem corretamente no banco.  
  â¤ Falta lÃ³gica de restauraÃ§Ã£o de sessÃ£o (`resume_session`).  

- **Logs do servidor (`logs/server.log`)**  
  ğŸ“‚ `backend/utils/logger_config.py`  
  â¤ Loggers ativos e configurados.  
  â¤ Adicionar logs de handshake TLS, falhas de autenticaÃ§Ã£o e conexÃµes encerradas.

---

## ğŸ’¾ Pessoa 3 â€” Banco de Dados e PersistÃªncia (JUJUBA)

### Caminhos e Status Geral

ResponsÃ¡vel pela **camada de persistÃªncia e integridade de dados** do CipherTalk.  
Essa parte garante que **usuÃ¡rios, mensagens e grupos sejam armazenados de forma segura, criptografada e auditÃ¡vel**, com suporte total a consultas e logs de auditoria.



### ğŸ—„ï¸ Banco SQLite + ConexÃ£o SQLAlchemy  
ğŸ“‚ `backend/database/connection.py`

âœ… **Implementado**
- Cria e gerencia o `engine` e `SessionLocal` (ORM do SQLAlchemy).  
- Banco fixo e seguro em `backend/database/cipher_talk.db`.  
- CompatÃ­vel com o servidor (`ensure_database()` integrado ao boot do backend).  
- Totalmente integrado aos loggers (`database.log` registra inicializaÃ§Ã£o e conexÃµes).

ğŸ”§ **Pendentes**
- Adicionar funÃ§Ã£o `ensure_database()` reutilizÃ¡vel no CLI para setup local.  
- Criar log adicional de verificaÃ§Ã£o automÃ¡tica do esquema (`[DB_VERIFY]`).


### ğŸ§© Modelagem de Tabelas  
ğŸ“‚ `backend/auth/models.py`

âœ… **Implementado**
- Tabelas: `User`, `Message`, `Group`, `GroupMember`.  
- Relacionamentos configurados com integridade referencial e *constraints* completas.  
- Suporte tanto a mensagens privadas quanto de grupo (regra XOR validada via `CheckConstraint`).  
- Estrutura pronta para consultas avanÃ§adas de auditoria (joins entre usuÃ¡rios, mensagens e grupos).

ğŸ”§ **Pendentes**
- Adicionar flag `User.is_online` (refletindo cache do servidor).  
- Inserir `cascade="all, delete-orphan"` nos relacionamentos dependentes (`sent_messages`, `received_messages`, `members`, `messages`).  
- Revisar indexaÃ§Ã£o por data e chaves compostas para otimizar consultas grandes.


### ğŸ’¬ Consultas e FunÃ§Ãµes SQL  
ğŸ“‚ `backend/database/queries/`

âœ… **Implementado**
- `users.py`: consultas completas (`list_all_users`, `get_user_by_username`, `update_public_key`).  
- `messages.py`: histÃ³rico, mensagens pendentes e descriptografia (`decrypt_stored_message`).  
- `groups.py`: criaÃ§Ã£o, adiÃ§Ã£o, remoÃ§Ã£o e listagem de membros, com logs administrativos.  
- Consultas compatÃ­veis com o **painel de auditoria `run_queries.py`**.

ğŸ”§ **Pendentes**
- Implementar funÃ§Ãµes de manutenÃ§Ã£o e consistÃªncia:  
  - `transfer_group_admin(db, group_name)` â€” promove novo admin se o atual sair.  
  - `delete_empty_groups(db)` â€” remove grupos Ã³rfÃ£os sem membros.  
- Adicionar logs explÃ­citos de transaÃ§Ã£o (`commit`, `rollback`) e falhas SQL.


### ğŸ” HistÃ³rico Criptografado  
ğŸ“‚ `backend/database/queries/messages.py` + `backend/server/handlers.py`

âœ… **Implementado**
- Armazenamento de mensagens 100% criptografado (IDEA + RSA hÃ­brido).  
- FunÃ§Ã£o `decrypt_stored_message()` permite auditoria e descriptografia local segura.  
- Logs integrados (`database.log` + `crypto.log`) documentam envio, recebimento e armazenamento.  
- Estrutura preparada para descriptografia automÃ¡tica no recebimento.

ğŸ”§ **Pendentes**
- Integrar descriptografia automÃ¡tica no fluxo de login (`handle_login`).  
- Criar cache opcional de mensagens descriptografadas (modo auditoria offline).  


### ğŸ§¾ Logs de Banco de Dados  
ğŸ“‚ `backend/utils/logger_config.py`

âœ… **Implementado**
- Logger `database_logger` com rotaÃ§Ã£o automÃ¡tica (`logs/database.log`).  
- SaÃ­da colorida e rastreamento de aÃ§Ãµes SQL e ORM.  
- IntegraÃ§Ã£o total com os loggers `server_logger`, `auth_logger` e `crypto_logger`.  
- Mensagens de auditoria registradas a cada consulta (`[AUDIT]` tags).

ğŸ”§ **Pendentes**
- Adicionar logs de transaÃ§Ã£o detalhados:
  - `[TX_COMMIT]`, `[TX_ROLLBACK]`, `[TX_PENDING]`.  
- (Opcional) Criar logger secundÃ¡rio `transaction_logger` para auditoria de transaÃ§Ãµes longas.


### ğŸ§® Painel de Auditoria (CLI de InspeÃ§Ã£o)
ğŸ“‚ `backend/database/run_queries.py`

âœ… **Implementado**
- Painel interativo somente leitura (modo auditoria).  
- Consultas disponÃ­veis:  
  1ï¸âƒ£  Listar usuÃ¡rios  
  2ï¸âƒ£  Buscar usuÃ¡rio (detalhes + grupos)  
  3ï¸âƒ£  Listar grupos  
  4ï¸âƒ£  Buscar grupo (informaÃ§Ãµes + membros)  
  5ï¸âƒ£  Listar usuÃ¡rios vinculados a grupos  
  6ï¸âƒ£  Ver mensagens privadas (pares)  
  7ï¸âƒ£  Ver mensagens de grupo  
- Todas as consultas sÃ£o `SELECT` (sem alteraÃ§Ãµes no banco).  
- Logs automÃ¡ticos de cada aÃ§Ã£o no `database.log` com tag `[AUDIT]`.

ğŸ”§ **Pendentes**
- Adicionar exportador opcional (`--export`) para gerar relatÃ³rios `.csv`.  
- Criar modo de filtro temporal (`--since <data>`) para limitar histÃ³rico em consultas grandes.


### âœ… Status Resumido
| Ãrea | Status | ObservaÃ§Ãµes |
|------|---------|-------------|
| ConexÃ£o SQLite | ğŸŸ© Completa | Pequenos ajustes de log |
| Modelagem ORM | ğŸŸ© Completa | Melhorar cascatas |
| Consultas SQL | ğŸŸ¨ Parcial | Faltam funÃ§Ãµes de manutenÃ§Ã£o |
| HistÃ³rico Criptografado | ğŸŸ¨ Parcial | Integrar descriptografia automÃ¡tica |
| Logs de Banco | ğŸŸ© Completa | Adicionar rastreamento de transaÃ§Ãµes |
| Painel de Auditoria | ğŸŸ© Completa | Adicionar exportaÃ§Ã£o opcional |

---


---


## ğŸ’¬ Pessoa 4 â€” Interface CLI e ExperiÃªncia do UsuÃ¡rio

### ğŸ§± Caminhos e status

- **CLI principal (`run_cli.py`)**
  ğŸ“‚ `run_cli.py` (raiz do projeto)  
  â¤ Implementado com menus e subfunÃ§Ãµes (login, envio, leitura).  
  â¤ Falta limpar terminal apÃ³s cada aÃ§Ã£o e centralizar logs.  

- **AutenticaÃ§Ã£o (`client/auth/`)**
  ğŸ“‚ `client/auth/signup_cli.py` e `client/auth/login_cli.py`  
  â¤ Ambos funcionais com TLS, mas sem tratamento de erros detalhado.  
  â¤ Verificar integraÃ§Ã£o RSA no cadastro e JWT no login.  

- **Envio e recebimento de mensagens**
  ğŸ“‚ `backend/messages/cli.py`  
  â¤ Implementado parcialmente com E2EE.  
  â¤ Corrigir handshake TLS e leitura de respostas JSON.  
  ğŸ“‚ `backend/messages/listener.py`  
  â¤ Listener funcional, falta reconexÃ£o automÃ¡tica e logs independentes.  

- **Mensagens offline**
  ğŸ“‚ `backend/server/handlers.py` e `backend/messages/cli.py`  
  â¤ Parcialmente implementado (armazenamento no banco).  
  â¤ Falta leitura automÃ¡tica no login.  

- **Lista de contatos**
  ğŸ“‚ `backend/messages/cli.py`  
  â¤ Implementado parcialmente via `list_users`.  
  â¤ Precisa atualizaÃ§Ã£o em tempo real com listener.  

- **Logs de aÃ§Ãµes do cliente (`logs/messages.log`)**
  ğŸ“‚ `backend/utils/logger_config.py`  
  â¤ Logger `messages_logger` ativo.  
  â¤ Falta integraÃ§Ã£o direta nos scripts CLI.

---

## ğŸ§­ ConclusÃ£o â€” Caminho para FinalizaÃ§Ã£o

| Ãrea | Arquivo-chave | Status | PrÃ³ximos passos |
|------|----------------|---------|----------------|
| IDEA / RSA | `backend/crypto/idea_manager.py` | âš ï¸ Parcial | Corrigir fallback e testar com IDEA nativo |
| Servidor | `backend/server/server.py` | âš™ï¸ Funcional | Revisar reconexÃ£o e TLS persistente |
| Banco de Dados | `backend/auth/models.py` | âš ï¸ Incompleto | Adicionar tabelas de grupos e histÃ³rico |
| CLI | `run_cli.py` | âš™ï¸ Funcional | Melhorar UX e logs no terminal |
| Logs | `backend/utils/logger_config.py` | âœ… Ativo | Criar `database_logger` e revisar formato JSON |

---

