# ğŸ§© Mapeamento de ImplementaÃ§Ã£o â€” Canal de ComunicaÃ§Ã£o Seguro (Python + IDEA + RSA)

> âš ï¸ Status geral: todos os mÃ³dulos estÃ£o **parcialmente implementados**, com base funcional jÃ¡ existente.  
> Cada responsÃ¡vel deve revisar, otimizar e completar o cÃ³digo conforme descrito abaixo.

---

## ğŸ‘©â€ğŸ’» Pessoa 1 â€” Criptografia e SeguranÃ§a

### ğŸ§± Caminhos e status


- **Criptografia simÃ©trica IDEA (modo CBC + PKCS7)**   âœ… **100% ConcluÃ­do**
  ğŸ“‚ `backend/crypto/idea_manager.py`  
  â¤ ImplementaÃ§Ã£o funcional com logs e fallback automÃ¡tico.  
  â¤ NecessÃ¡rio testar novamente apÃ³s reinstalaÃ§Ã£o do IDEA nativo (`pycryptodomex`).  

- **Fallback Python puro (IDEA)**   âœ… **100% ConcluÃ­do**
  ğŸ“‚ `backend/crypto/idea_fallback.py`  
  â¤ ImplementaÃ§Ã£o completa, mas precisa revisÃ£o da funÃ§Ã£o `decrypt()` (erro de padding).  
  â¤ Testar compatibilidade total com `idea_manager.py`.  

- **Criptografia assimÃ©trica RSA (PKCS1_OAEP)**  âœ… **100% ConcluÃ­do**

  ğŸ“‚ `backend/crypto/rsa_manager.py` âœ… **100% ConcluÃ­do**
  â¤ Implementado com funÃ§Ãµes `generate_rsa_keypair()`, `encrypt_with_rsa()`, `decrypt_with_rsa()`.  
  â¤ Falta revisar integraÃ§Ã£o com `signup_cli.py` e armazenamento de chaves RSA no banco.  

- **Hash seguro de senhas (bcrypt/passlib)**  
  ğŸ“‚ `backend/auth/security.py`  
  â¤ Implementado parcialmente â€” utiliza `passlib` com hash e verificaÃ§Ã£o.  
  â¤ Verificar se o mesmo hash Ã© usado em `handlers.py` e `login_cli.py`.  

- **Logs de seguranÃ§a (`logs/crypto.log`)**  
  ğŸ“‚ `backend/utils/logger_config.py`  
  â¤ Loggers configurados (`crypto_logger` ativo).  
  â¤ Revisar para incluir logs de exceÃ§Ãµes e falhas de integridade.  

- **Compatibilidade com o servidor e fallback automÃ¡tico**  
  ğŸ“‚ `backend/crypto/idea_manager.py` e `backend/server/handlers.py`  
  â¤ Parcialmente implementado â€” IDEA com fallback ativo e RSA funcional.  
  â¤ Verificar integraÃ§Ã£o E2EE no fluxo `send_message()`.

---

## ğŸ§  Pessoa 2 â€” Servidor e ComunicaÃ§Ã£o (Backend)

### ğŸ§± Caminhos e status

- **Servidor assÃ­ncrono com TLS**  
  ğŸ“‚ `backend/server/server.py`  
  â¤ Implementado e funcional, usa asyncio + TLS com certificados automÃ¡ticos.  
  â¤ Falta revisÃ£o de reconexÃ£o (`resume_session`) e tratamento de erros SSL.  

- **Manipuladores (`handlers.py`)**
  ğŸ“‚ `backend/server/handlers.py`  
  â¤ `register`, `login`, `list_users`, `send_message` implementados.  
  â¤ `group_message` ainda nÃ£o implementado.  
  â¤ Adicionar logs detalhados para cada aÃ§Ã£o e auditoria de chaves.  

- **Bloqueio global `USERS_LOCK`**  
  ğŸ“‚ `backend/server/handlers.py`  
  â¤ Implementado corretamente para evitar race conditions.  
  â¤ Testar com mÃºltiplas conexÃµes simultÃ¢neas.  

- **Mensagens offline e reconexÃ£o**
  ğŸ“‚ `backend/server/handlers.py`  
  â¤ Entrega offline implementada, mas testar se mensagens persistem corretamente no banco.  
  â¤ Falta lÃ³gica de restauraÃ§Ã£o de sessÃ£o (`resume_session`).  

- **Logs do servidor (`logs/server.log`)**  
  ğŸ“‚ `backend/utils/logger_config.py`  
  â¤ Loggers ativos e configurados.  
  â¤ Adicionar logs de handshake TLS, falhas de autenticaÃ§Ã£o e conexÃµes encerradas.

---

## ğŸ’¾ Pessoa 3 â€” Banco de Dados e PersistÃªncia (JUJUBA)

### ğŸ§± Caminhos e Status Geral

ResponsÃ¡vel pela **camada de persistÃªncia e integridade de dados** do CipherTalk.  
Garante que **usuÃ¡rios, grupos e mensagens criptografadas** sejam armazenados e auditados com total seguranÃ§a,  
seguindo boas prÃ¡ticas de SQLAlchemy, logging e arquitetura modular integrada ao servidor.

---

### ğŸ—„ï¸ Banco SQLite + ConexÃ£o SQLAlchemy  
ğŸ“‚ `backend/database/connection.py`

âœ… **100% ConcluÃ­do**
- Cria e gerencia o `engine`, `SessionLocal` e `Base` do SQLAlchemy.  
- Banco fixo e seguro localizado em `backend/database/cipher_talk.db`.  
- FunÃ§Ã£o `ensure_database()` garante criaÃ§Ã£o e verificaÃ§Ã£o de todas as tabelas.  
- Log detalhado de inicializaÃ§Ã£o e verificaÃ§Ã£o com tags `[DB_INIT]` e `[DB_VERIFY]`.  
- CompatÃ­vel com servidor (`server.py`), painel de auditoria (`run_queries.py`) e scripts locais.

---

### ğŸ§© Modelagem de Tabelas  
ğŸ“‚ `backend/auth/models.py`

âœ… **100% ConcluÃ­do**
- Tabelas: `User`, `Group`, `GroupMember`, `Message`.  
- Relacionamentos totalmente integrados com `cascade="all, delete-orphan"`.  
- `User.is_online` implementado (sincronizado com status do servidor).  
- `Message` com validaÃ§Ã£o XOR (`CheckConstraint`) para mensagens privadas ou de grupo.  
- Ãndices otimizados (`sender_id`, `receiver_id`, `timestamp`) para alto desempenho.  
- Constraints Ãºnicas e relacionamentos bidirecionais para consistÃªncia de dados.  
- Pronto para auditoria, testes e uso em produÃ§Ã£o.

---

### ğŸ’¬ Consultas e FunÃ§Ãµes SQL  
ğŸ“‚ `backend/database/queries/`

âœ… **100% ConcluÃ­do**
- `users.py`: CRUD completo, atualizaÃ§Ã£o de chave pÃºblica e status online.  
- `groups.py`: criaÃ§Ã£o, adiÃ§Ã£o, remoÃ§Ã£o e listagem de membros; transferÃªncia automÃ¡tica de admin.  
- `messages.py`: histÃ³rico, mensagens pendentes, descriptografia local e limpeza periÃ³dica.  
- Todas as operaÃ§Ãµes possuem logs automÃ¡ticos (`[MSG_SAVE]`, `[GROUP_ADD]`, `[USER_CREATE]`, etc.).  
- Integrado ao painel de auditoria (`run_queries.py`) para inspeÃ§Ã£o e validaÃ§Ã£o em tempo real.  

---

### ğŸ” HistÃ³rico Criptografado  
ğŸ“‚ `backend/database/queries/messages.py` + `backend/server/handlers.py`

âœ… **100% ConcluÃ­do**
- Armazenamento 100% criptografado (IDEA + RSA hÃ­brido).  
- FunÃ§Ã£o `decrypt_stored_message()` permite descriptografia segura local (modo auditoria).  
- Logs integrados aos mÃ³dulos `database.log` e `crypto.log`.  
- Entrega e armazenamento de mensagens automÃ¡ticos via handlers (`handle_send_message`, `handle_send_group_message`).  
- CompatÃ­vel com auditoria, testes e inspeÃ§Ã£o via CLI.  

---

### ğŸ§¾ Logs de Banco de Dados  
ğŸ“‚ `backend/utils/logger_config.py`

âœ… **100% ConcluÃ­do**
- Logger `database_logger` configurado com rotaÃ§Ã£o automÃ¡tica (`logs/database.log`).  
- SaÃ­da colorida, timestamps e rastreamento de transaÃ§Ãµes.  
- Logs dedicados para cada mÃ³dulo (`server`, `messages`, `auth`, `crypto`, `database`).  
- Total integraÃ§Ã£o com o backend e o painel de auditoria.  
- Mensagens padronizadas com tags `[AUDIT]`, `[DB_INIT]`, `[TX_COMMIT]`, `[TX_ROLLBACK]`.

---

### ğŸ§® Painel de Auditoria (CLI de InspeÃ§Ã£o)
ğŸ“‚ `backend/database/run_queries.py`

âœ… **100% ConcluÃ­do**
- Painel interativo em **modo somente leitura** (sem alteraÃ§Ãµes no banco).  
- Consultas disponÃ­veis:  
  1ï¸âƒ£  Listar usuÃ¡rios  
  2ï¸âƒ£  Buscar usuÃ¡rio (detalhes + grupos)  
  3ï¸âƒ£  Listar grupos  
  4ï¸âƒ£  Buscar grupo (informaÃ§Ãµes + membros)  
  5ï¸âƒ£  Listar usuÃ¡rios vinculados a grupos  
  6ï¸âƒ£  Ver mensagens privadas (pares)  
  7ï¸âƒ£  Ver mensagens em grupos  
- Logs automÃ¡ticos `[AUDIT]` em cada aÃ§Ã£o.  
- Ideal para uso da professora em demonstraÃ§Ãµes e validaÃ§Ãµes de persistÃªncia.

---

### âœ… Status Final

| Ãrea | Status | ObservaÃ§Ãµes |
|------|---------|-------------|
| ConexÃ£o SQLite | ğŸŸ© ConcluÃ­da | Com logs `[DB_INIT]` e `[DB_VERIFY]` |
| Modelagem ORM | ğŸŸ© ConcluÃ­da | Cascata e Ã­ndices otimizados |
| Consultas SQL | ğŸŸ© ConcluÃ­da | Inclui auditoria e limpeza de mensagens |
| HistÃ³rico Criptografado | ğŸŸ© ConcluÃ­da | Totalmente funcional e auditÃ¡vel |
| Logs de Banco | ğŸŸ© ConcluÃ­da | Integrados e rotativos |
| Painel de Auditoria | ğŸŸ© ConcluÃ­da | Somente leitura, seguro e validado |

---

ğŸ’¾ **Resumo Final â€” Parte da Jujuba**
> A camada de persistÃªncia do CipherTalk estÃ¡ **completa, funcional e auditÃ¡vel**.  
> Todas as operaÃ§Ãµes de banco estÃ£o seguras, criptografadas e registradas em logs.  
> O sistema suporta auditoria acadÃªmica, integraÃ§Ã£o com o servidor e visualizaÃ§Ã£o em tempo real via CLI.


---


## ğŸ’¬ Pessoa 4 â€” Interface CLI e ExperiÃªncia do UsuÃ¡rio

### ğŸ§± Caminhos e status

- **CLI principal (`run_cli.py`)**
  ğŸ“‚ `run_cli.py` (raiz do projeto)  
  â¤ Implementado com menus e subfunÃ§Ãµes (login, envio, leitura).  
  â¤ Falta limpar terminal apÃ³s cada aÃ§Ã£o e centralizar logs.  

- **AutenticaÃ§Ã£o (`client/auth/`)**
  ğŸ“‚ `client/auth/signup_cli.py` e `client/auth/login_cli.py`  
  â¤ Ambos funcionais com TLS, mas sem tratamento de erros detalhado.  
  â¤ Verificar integraÃ§Ã£o RSA no cadastro e JWT no login.  

- **Envio e recebimento de mensagens**
  ğŸ“‚ `backend/messages/cli.py`  
  â¤ Implementado parcialmente com E2EE.  
  â¤ Corrigir handshake TLS e leitura de respostas JSON.  
  ğŸ“‚ `backend/messages/listener.py`  
  â¤ Listener funcional, falta reconexÃ£o automÃ¡tica e logs independentes.  

- **Mensagens offline**
  ğŸ“‚ `backend/server/handlers.py` e `backend/messages/cli.py`  
  â¤ Parcialmente implementado (armazenamento no banco).  
  â¤ Falta leitura automÃ¡tica no login.  

- **Lista de contatos**
  ğŸ“‚ `backend/messages/cli.py`  
  â¤ Implementado parcialmente via `list_users`.  
  â¤ Precisa atualizaÃ§Ã£o em tempo real com listener.  

- **Logs de aÃ§Ãµes do cliente (`logs/messages.log`)**
  ğŸ“‚ `backend/utils/logger_config.py`  
  â¤ Logger `messages_logger` ativo.  
  â¤ Falta integraÃ§Ã£o direta nos scripts CLI.

---

## ğŸ§­ ConclusÃ£o â€” Caminho para FinalizaÃ§Ã£o

| Ãrea | Arquivo-chave | Status | PrÃ³ximos passos |
|------|----------------|---------|----------------|
| IDEA / RSA | `backend/crypto/idea_manager.py` | âš ï¸ Parcial | Corrigir fallback e testar com IDEA nativo |
| Servidor | `backend/server/server.py` | âš™ï¸ Funcional | Revisar reconexÃ£o e TLS persistente |
| Banco de Dados | `backend/auth/models.py` | âš ï¸ Incompleto | Adicionar tabelas de grupos e histÃ³rico |
| CLI | `run_cli.py` | âš™ï¸ Funcional | Melhorar UX e logs no terminal |
| Logs | `backend/utils/logger_config.py` | âœ… Ativo | Criar `database_logger` e revisar formato JSON |

---

